## 巨大なソースの修正
### システムの仕様

### ■システム仕様

今回修正していただくシステムは、以下の要件を満たすユーザー管理システムです。

**要件：**

- ユーザーの情報をデータベースに挿入したり、検索したりなどの管理を全て行える管理システム

- 全てのページからトップページに戻れる

- データベース接続はとても重い処理のため、なるべく回数が少なくなるようにする

- 直リンクしてもよいページ、してはいけないページを正しく区別する

- 一般的なユーザーが使うということを強く意識するように。無骨な表現は避ける


&nbsp;

### ■ディレクトリ構成

``` Text
├─ app
│　├─ index.php
│　├─ insert.php
│　├─ insert_confirm.php
│　├─ insert_result.php
│　├─ search.php
│　├─ search_result.php
│　├─ result_detail.php
│　├─ update.php
│　├─ update_result.php
│　├─ delete.php
│　└─ delete_result.php
│
└─ common
　　├─ scriptUtil.php
　　├─ dbaccessUtil.php
　　└─ defineUtil.php

```
**app**

  * データの挿入、検索などのDB操作を行える画面をまとめたディレクトリ。このシステムの根幹

**common**

  * utilディレクトリには共通処理をまとめたscriptUtilと、データベースへのアクセスをまとめたdbaccess、共通で用いる定数をまとめたdefineUtilを、ユーティリティ(便利)フォルダとしてまとめておく

&nbsp;

### ■ページ遷移(簡易)

``` Text
index → insert → insert_confirm → insert_result
 ↓
search → search_result → result_detail
                          ├ update → update_result
                          └ delete → delete_result

※詳細はスライド内の「ページ遷移」を参照してください。
```

&nbsp;

### ■index（トップページ）
- トップページ
- このシステムの簡単な説明が記載されている。テキストは自由
- insertとsearchへの直リンクが貼られている。テキストは自由

### ■insert（新規登録 - 入力画面）
- プロフィールを入力できるフォームを設置
- 設置するフォームは以下の通り
 - 名前
 - 生年月日（1950~2010年までのプルダウン選択式。月、日も）
 - 種別（エンジニア/営業/その他をラジオボタンで。）
 - 電話番号
 - 自己紹介
- 送信ボタン付き
- insert_confimから戻ってきた場合、フォームや選択ボタンは入力済みになる
- 送信ボタン押下後はinsert_confirmへとデータを渡しながら(SESSIONに再度格納)遷移

### ■insert_confirm（新規登録 - 確認画面)
- フォームで入力された文字や選択を表示し、「上記の内容で登録いたします。よろしいですか？」と表示。
「はい」でinsert_resultに遷移「いいえ」でinsertに値を保持したまま遷移。
（戻った時にフォームが入力済みになっている）

- もしデータが不足していた場合はどの項目のデータが不足しているのかを表示。
insertに値を保持したまま遷移するリンクを表示

### ■insert_result（新規登録 - 完了画面）
- プロフィール用のDBに値を挿入。この際、現在日時(年月日時分秒)を取得し、追加。
- 「以上の内容で登録しました。」とinsert_confirmのようにフォームで入力された値を表示。
- 接続に失敗したときの表示などもカバーすること。

### ■search（検索 - 条件画面）
- 検索条件をフォームに記入してから検索できる。
- 検索条件は以下の通り
 - 名前(部分一致)
 - 生年
 - 種別
- 値の渡し方はGETを使用
- 複合検索

### ■search_result（検索 - 結果一覧）
- 検索結果がID昇順にテーブル型で表示される
- 検索結果として表示されるのは名前、生年、種別、登録日のみ
- 名前がクリック可能になっており、クリックするとresult_detailへ遷移する
- 検索で何も入力されていないときは全件表示

### ■result_detail（ユーザー詳細ページ）
- クリックされた個人の詳細情報を表示

- 表示項目はDBカラムのすべての項目

- ボタンとして「変更」、「削除」ボタンを表示し、それぞれupdate、deleteに遷移する。
この際、ユーザの情報を遷移先へ受け渡す。

- 検索結果画面へ戻るボタン付き

### ■update（更新 - 入力画面）
- フォームから入力するデータで既にあるデータを更新できる

- 画面構成はinsertと同じ。
ただし、初めはresult_detailから個人のデータを受け取り、フォーム内に直接記入された状態である。
このフォームの内容を書き換えていくことでデータの更新ができる

- 送信ボタン、詳細画面へ戻るボタン付き

### ■update_result（更新 - 完了画面）
- IDなどを受け取り、DBに値を挿入。現在日時(年月日時分秒)を取得し、更新。
- 「以上の内容で更新しました。」と、フォームで入力された値を表示
- 詳細画面へ戻るボタン付き
- 接続に失敗したときの表示などもカバーすること

### ■delete（削除 - 入力画面）
- result_detailで表示されていたレコードをまるまる削除する
- 対象のレコードの全データを表示したのちに、「このレコードを本当に削除しますか？」という質問があり、「はい」と「いいえ」が直リンクとして設置してある。「はい」ならdelete_resultへ、「いいえ」ならresult_detailに戻る

### ■delete_result（削除 - 完了画面）
- ここにアクセスした段階で、IDによる削除が実行される
- 「削除しました」という一文が表示される
- 失敗したときの表示などもカバーすること
- 検索結果画面に戻るボタン付き

### ■scriptUtil.php（共通 - スクリプトの処理）

- よく使うユーザー定義関数をまとめておく

- 例えば、トップへのリンクを挿入する処理をまとめておけば、
すべてのページでこのリンクを使用するときにそのユーザー定義関数を挿入するだけでよくなる

### ■dbaccessUtil.php（共通 - データベースの処理）

データベースアクセス系のユーザー定義関数を格納する

### ■defineUtil.php（共通 - 定数定義）

- システム内で使われる具体的な定数(topページなどのURLや、MySQLユーザー名、パスワード)などをまとめて定義しておく場所。
ここで定義しておき全.phpでrequireすれば、いちいち変数を宣言する必要がなくなる

- const $~~=・・・; という表記のみが記述されている。


### ■データベースの構成

ユーザー情報を管理するテーブルuser_tを利用します。
challenge_dbに新しくcreateしましょう。

``` Text
テーブル名:user_t

カラム名｜userID｜name        ｜birthday｜tell        ｜type｜comment｜newDate
------------------------------------------------------------------------------
データ型｜int   ｜varchar(255)｜Date    ｜varchar(255)｜int ｜text   ｜Datetime
```

**※userIDにはprimaryKey,autoincrementを設定して下さい。**
