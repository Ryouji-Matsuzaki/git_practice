## 総まとめ
### 仕様

### ■ディレクトリ構成

``` Text
├─ app
│　├─ top.php
│　├─ search.php
│　├─ item.php
│　├─ add.php
│　├─ login.php
│　├─ registration.php
│　├─ registration_confirm.php
│　├─ registration_complete.php
│　├─ mydata.php
│　├─ mydata_update.php
│　├─ ・・・・・
│　├─ buy_confirm.php
│　└─ buy_complete.php
│
└─ util
　　├─ scriptUtil.php
　　├─ dbaccessUtil.php
　　└─ defineUtil.php
```
**app**

- データの挿入、検索などのDB操作を行える画面をまとめたディレクトリ。  
このシステムの根幹

**common**

- utilディレクトリには共通処理をまとめたscriptUtilと、データベースへのアクセスをまとめたdbaccess、  
共通で用いる定数をまとめたdefineUtilを、ユーティリティ(便利)フォルダとしてまとめておく

&nbsp;

### ■ページ遷移(簡易)

``` Text
top    → login
 ↓         ↓
search → registration → registration_confirm → resistration_complete
 ↓
item   → mydata ↔ mydata_update
 ↓
add    → cart → buy_confirm → buy_complete

※詳細はスライド内の「ページ遷移」を参照してください。
```

&nbsp;

### ■システムの共通機能
全てのページに、「ログイン」を表示。

ログイン済みの場合、「ログイン」の代わりに「ログアウト」と「買い物かご」を表示。
さらに、「ようこそ(ユーザー名[クリック可能])さん！」を表示。

### ■top（トップページ）
- このシステムの簡単な説明が記載されている。テキストは自由

- キーワード検索フォームが設置されている。検索の遷移先はsearchで、GETメソッド。
未入力ならエラーを表示

### ■search（結果一覧）
- topから検索により遷移できる。
YahooショッピングAPIに直接検索キーワードを渡し、その結果を受け取り＆表示している

- 検索キーワード、検索結果数を表示

- 縦のリスト型に表示。サムネイルと、その横に商品名、金額が載っている。
クリックでitemへ

- 結果は上位20件まで

### ■item（商品詳細ページ）
- serchまたはcartから遷移できる。商品IDをGETメソッドにより受け渡す
- YahooショッピングAPIから取得したデータで、より詳細な情報(概要や評価値)、が表示される
- 「カートに追加する」ボタンがあり、クリックするとaddに遷移する。

### ■add（カートへ商品を追加）
- 商品の情報を受け取り、クッキーやセッションに追加する
- 画面には「カートに追加しました」という文言が出てくる。

### ■login（ログインページ）
- どのページからも遷移できる。ログインしているかいないかで処理が分岐する

- ログインしていない状態(各ページの「ログイン」というリンクから)で遷移してきた場合は、
ユーザー名とパスワードを入力するフォームが表示される。
また、「新規会員登録」というリンクも表示される。

- ログインに成功すると、その情報をログイン状態を管理できるセッションに書き込み、
そのまま直前まで閲覧していたページに遷移する

- ログインしている状態で(各ページの「ログアウト」というリンクから)遷移してきた場合は、
ログアウト処理を行う(セッションの破棄、クッキーに保存されたセッションIDを破棄)その後topへ

- ユーザーデータの削除フラグが1の場合は削除されたユーザーとして処理すること

### ■registration（会員登録 - 入力画面）
- loginからのみ遷移

- フォームがあり、入力するのは以下の要素
 - ユーザー名
 - パスワード
 - メールアドレス
 - 住所

- registrationconfirmから戻ってきた場合は、値を保持して記入済みにできる


### ■registration_confirm（会員登録 - 確認画面）
- フォームで入力された文字や選択を表示し、「上記の内容で登録いたします。よろしいですか？」と表示。
「はい」でregistration_complete「いいえ」でregistrationに値を保持したまま(戻った時にフォーム入力済みになっている)遷移

- もし入力が不足していた場合はどの項目のデータが不足しているのかを表示。
insertに値を保持したまま遷移するリンクを表示

### ■registration_complete（会員登録 - 完了画面）
- プロフィール用のDBに値を挿入。この際、現在時(年日時分)を組み込み関数で取得し、追加。
- 「以上の内容で登録しました。」とregistration_confirmのようにフォームで入力された値を表示
- 「トップページへ戻る」のリンクが、目立つ場所に設置されている

### ■cart（カートページ）
- 「カートに追加」でクッキーやセッションに保存された登録情報が登録古い順に表示される

- 商品の写真と名前(リンクつき)、金額を表示。

- 画面下部に全額の合計金額を表示する

- 「購入する」ボタンあり

- 各商品には「削除」のリンクあり。このリンクをクリックすることで、カートから商品を削除する

- カートの中身はユーザー毎に切り替えられる

- ログインしていない状態ならばログインページに遷移、そこでログインに成功した場合、
非ログイン状態で「カートに追加」操作をしていた商品はそのユーザー用のカートに移る

### ■buy_confirm（購入 - 確認画面）
- カートに追加順で商品の名前(リンクなし)、金額が表示される
- 合計金額が表示され、その下に発送方法を選択するラジオボタンがある。
- 「上記の内容で購入する」ボタンと「カートに戻る」ボタンがある。


### ■buy_complete（購入 - 完了画面）
- 購入データを保存
- 総購入金額を更新
- 「購入が完了しました」と表示

### ■mydata（会員情報 - 閲覧画面）
- 登録したユーザー情報が閲覧できる(ユーザーID以外全て)
- 購入履歴へのリンクあり
- 登録情報を更新する、削除するリンクあり

### ■myhistory（会員情報 - 購入履歴）
- これまで購入した商品の履歴が見れる

### ■myupdate（会員情報 - 更新画面）
- フォームから入力するデータで既にあるデータを更新できる

- 画面構成はregistrationと同じ。フォーム内に直接記入された状態である。
このフォームの内容を書き換えていくことでデータの更新ができる

- 送信ボタン付き

### ■myupdate_result（会員情報 - 更新完了画面）
- IDなどを受け取り、DBを更新。
- 「以上の内容で更新しました。」と、フォームで入力された値を表示

### ■mydelete（会員情報 - 削除画面）
- 対象のレコードの全データを表示したのちに、「このユーザーをマジで削除しますか？」という質問があり、  
「はい」と「いいえ」が直リンクとして設置してある。  
「はい」ならmydelete_resultへ、そうでないならトップページへ遷移する

### ■mydelete_result（会員情報 - 削除完了画面）
- ここにアクセスした段階で、IDによる削除が実行される
(外部キー制約により直接DELETEは出来ないので、削除フラグを0から1に変更する)

- 「削除しました」という一文が表示される

### ■scriptUtil（共通 - スクリプトの処理）

- よく使うユーザー定義関数をまとめておく

- 例えば、トップへのリンクを挿入する処理をまとめておけば、
すべてのページでこのリンクを使用するときにそのユーザー定義関数を挿入するだけでよくなる


### ■dbaccessUtil（共通 - データベースの処理）

- データベースアクセス系のユーザー定義関数を格納する

### ■defineUtil（共通 - 定数定義）

- システム内で使われる具体的な定数(topページなどのURLや、MySQLユーザー名、パスワード)などをまとめて定義しておく場所。
ここで定義しておき全.phpでrequireすれば、いちいち変数を宣言する必要がなくなる

- const $~~=・・・; という表記のみが記述されている。

### ■データベースの構成
まず、かごゆめ用のデータベース「kagoyume_db」を作成してください。
その上で、会員情報管理用テーブルと購入履歴テーブルを作成します。

``` Text
テーブル名:user_t
会員情報管理テーブル。
初回の登録や更新以外に、購入時には総購入金額が更新

カラム名｜userID｜name        ｜password    ｜mail        ｜address｜total｜newDate ｜deleteFlg
-----------------------------------------------------------------------------------------------
データ型｜int   ｜varchar(255)｜varchar(255)｜varchar(255)｜text   ｜int  ｜Datetime｜int(初期値0)
```

**※userIDにはprimaryKey,autoincrementを設定して下さい。**

&nbsp;

``` Text
テーブル名:buy_t
購入管理テーブル。
1度の購入につき購入する商品の個数分生成される

カラム名｜buyID｜userID       ｜itemCode    ｜type｜buyDate
----------------------------------------------------------
データ型｜int  ｜int(外部キー) ｜varchar(255)｜int ｜Datetime
```

**※buyIDにはprimaryKey,autoincrementを設定して下さい。**
