## データ操作
### クッキー

### ■クッキー

**cookie（クッキー）** という名前を聞いた事がある人も多いと思います。ブラウザとは切っても切れない関係にあるものです。

cookieが何をしているかというと、Webページの処理をスムーズにするため、アクセスしたサイト毎の情報を管理しています。

このcookieの情報は、サーバーとブラウザーで相互にやり取りされ、パソコンの中にもcookieの情報が保存されています。

そして、PHPではこのcookieの情報を操作する事が可能です。また、cookieに必要なデータを保存し、次回接続時に流用する事も可能です。

### ■cookieの利用

PHPにはcookieに情報を書き込むための関数が用意されています。

** cookieに情報を書き込む（setcookie関数）：**

* 情報を書き込む

  * 変数 = setcookie(名前, 値);


* 有効期限を指定して、情報を書き込む

  * 変数 = setcookie(名前, 値, 有効期限);

有効期限を指定しない場合には、デフォルトの有効期限が適用されます。

```php
<?php

// ユーザーのアクセス日時を保存する処理
// ユーザーの１回目の訪問
$access_time = date('Y年m月d日');
setcookie('LastLoginDate', $access_time);

```

PHPでcookieの内容を利用する場合、$\_COOKIEを利用します。

* $\_COOKIEの利用方法：

  * 変数 = $\_COOKIE[名前];

$\_COOKIEも$\_GETや$\_POSTと同じようなスーパーグローバル変数です。

```php
<?php

// ユーザーのアクセス日時を表示する処理
echo '前回のアクセス日時：' . $_COOKIE['LastLoginDate'];
```

### ■cookieのタイムラグ

cookieの扱いについて、１点気を付けるべきポイントがあります。
それは、setcookie関数と$\_COOKIEが連動していないという点です。

$\_COOKIEは、利用者がアクセスしたタイミングのcookie情報を読み込みます。

setcookie関数は、$\_COOKIEではなく、cookieそのものに情報を書き込みます。そのため、setcookie関数を実施しても、$\_COOKIEは書き変わらないのです。

setcookieの内容が$\_COOKIEに正しく反映されるのは、次回アクセス時になります。
これがcookieのタイムラグです。

** setcookie関数を実施しても、即座に$\_COOKIEが更新されるわけではない ** と覚えておきましょう。

### ■クッキーの扱い

少し脱線しますが、クッキーの扱いについて。

cookieはユーザーが一度ページを離れても情報をキープできるため、非常に重要な要素です。

ただし、前述した通り、cookieは利用者のパソコンに保存されます。そのため、ネットカフェなど不特定多数がパソコンを利用する環境では、他人のcookieを盗み見て個人の情報を抜き出す事も可能です。

基本的に便利なcookieですが、そこに保管する情報は誰でも見ることのできるものだと考えましょう。そして、個人を特定できるような情報（ID/パスワード/住所など）はcookieで扱うのを控えましょう。

また、cookieの有効期限を設定し、長期にわたり利用されなかった場合は無効とするなども検討しましょう。
