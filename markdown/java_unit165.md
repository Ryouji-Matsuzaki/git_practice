# DB操作

## エラーハンドリング


## ■エラーハンドリングとは
システムが大きくなればなるほど、プログラミングとは別の要因による傷害の可能性が高まります。  

データベース操作もその１つで、プログラムが正しく作成されていても、  
* ネットワークがダウンしている
* データベースがダウンしている
* 接続情報が間違っている  
などの要因で正しく動かない事が想定されます。  
こうなると、プログラム側では正常に動作させるのは難しくなります。  

そういった状況へ対処するための施策が、**エラーハンドリング** です。  
**エラーハンドリング** とは、障害（例外という）が発生した時にその例外をハンドリングし、
安全にシステムを停止させる手段です。  
ここでは、データベースへの接続を例にエラーハンドリングを学びます。  


## ■DB操作のエラーハンドリング
エラーハンドリングに用いるのはtry-catch-finallyです。

まず、例外の発生が予見される処理をtryで囲みます。その後に例外が発生した場合に処理を行うcatch部分を実装し、必要であればfinallyを用意します。

　**エラーハンドリング（try-catch-finally）：**  
　　try {  
　　　　// 例外の発生が予見される処理  
　　} catch (例外クラス) {  
　　　　// 例外が発生した場合の処理  
　　} finally {  
　　　　// 例外の有無関係なく、実施したい処理  
　　}  

※実際のコードは当該スライドを参照してください。

##  ■例外時のDB接続のクローズ
データベース操作において、例外の発生タイミングは接続のタイミングだけとは限りません。そのため、例外が発生した際にDBへの接続が保持されている可能性があります。  

DB接続処理を作成する際には、この可能性まで視野に入れた例外処理を施しましょう。  

下記（当該スライド赤枠部分）ではdb_con変数に中身がある場合は、クローズ処理を呼び出す様に実装しています。これにより、例外が発生した場合にDBに接続していても、きちんと切断される様になります。  

```
if (db_con != null){
  try {
    db_con.close();
  } catch (Exception e_con) {
      System.out.println(e_con.getMessage());
  }
}
```

例外処理を実装する際は、単純に例外をcatchするだけでなく、発生後に影響が残らない様に処理する事を意識しましょう。  
